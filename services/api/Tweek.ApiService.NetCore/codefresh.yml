version: '1.0'
steps:
  BuildingSolution:
    title: Building Solution
    image: microsoft/aspnetcore-build:1.0-1.1
    commands: 
      - apt update && apt install gettext -y
      - cd CI && envsubst < ./NuGet.Config.tmpl > NuGet.Config
      - dotnet restore ./Tweek.sln --configfile ./CI/NuGet.Config
      - dotnet build ./Tweek.sln -c Release
      - dotnet publish ./services/api/Tweek.ApiService.NetCore/Tweek.ApiService.NetCore.csproj -c Release -o ${{CF_VOLUME_NAME}}/publish

  BuildingDockerImage:
    title: Building Docker Image
    type: build
    image_name: soluto/tweek-api
    working_directory: ${{CF_VOLUME_NAME}}/publish
    dockerfile: ${{main_clone}}/services/api/Tweek.ApiService.NetCore/Dockerfile
    build_arguments: 
      - source=.
