version: '1.0'
steps:
  BuildingSolution:
    title: Building Solution
    image: microsoft/aspnetcore-build:1.0-1.1
    commands: 
      - apt update && apt install gettext -y
      - cd CI && envsubst < ./NuGet.Config.tmpl > NuGet.Config
      - dotnet restore ./Tweek.sln --configfile ./CI/NuGet.Config
      - dotnet publish ./Tweek.sln -c Release -o ./obj/Docker/publish

  CheckDir:
    image: alpine:latest
    working_directory: ./services/api/Tweek.ApiService.NetCore/
    commands:
      - ls
      - cd obj && ls
      - cd obj/Docker && ls
      - cd obj/Docker/publish && ls

  BuildingDockerImage:
    title: Building Docker Image
    type: build
    image_name: soluto/tweek-api
    working_directory: ./services/api/Tweek.ApiService.NetCore/
    dockerfile: Dockerfile
