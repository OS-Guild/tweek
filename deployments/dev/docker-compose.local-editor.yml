version: '3.4'

services:
  publishing:
    build:
      args:
        target: Release

  editor:
    environment:
      - CONTINUOUS_UPDATER_INTERVAL=500

  authoring:
    environment:
      - CONTINUOUS_UPDATER_INTERVAL=500

  api:
    build:
      args:
        target: Release
    depends_on:
      - publishing
    environment:
      - CorsPolicies__Keys__Origins=http://localhost:3000
      - CorsPolicies__Keys__Methods=GET
      - CorsPolicies__Keys__MaxPreflightAge=60
      - CorsPolicies__Keys__Headers=
      - CorsPolicies__Keys__ExposedHeaders=
      - CorsEnabled=true

  gateway:
    depends_on:
      - minio
      - nats
      - oidc-server-mock
    environment:
      - CONFIGOR_ENV=local-editor

  oidc-server-mock:
    container_name: oidc-server-mock
    image: soluto/oidc-server-mock
    ports:
      - "8081:80"
    environment:
      - REDIRECT_URIS=http://localhost:3000/auth-result/oidc

secrets:
  tweek_ssh_private_key:
    file: ./ssh/tweekgit
  minio_access_key:
    file: ./minio/access_key
  minio_secret_key:
    file: ./minio/secret_key
